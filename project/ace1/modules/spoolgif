!
! Add menu option to produce a GIF image of the current plot in the
! appropriate spool directory, depending on the platform.
!
! Basically this is an easy interface to the spoolgif perl script, which
! recognizes certain platforms and does the right thing for each.
!
! spoolgif c$msgname window_name platform

!
! A menu which windows can reference in icon buttons
!
define widget snapshot-menu intmenu "spoolgif menu"
	title "Snapshot Menu"
	line
	entry "Spool GIF image (window must be visible)" dump-gif
endmenu



procedure shell cmd string

!	local dmcmd concat("message ",quote(cmd))
!	dm dmcmd
	local dmcmd concat("shell ",quote(cmd))
	dm dmcmd

endprocedure


! Perform a few safety checks first, such making sure we're not in 
! real-time mode, in which case the plot-time is wrong.

procedure dump-gif

	local platform PDParam("global", "platform")
	if (PDParam("global", "plot-mode") = "real-time")
		message "Cannot dump real-time plots."
		message "First set this plot to a history time."
		return
	endif

! Check our platform from the global component

	if (platform = "(Undefined)")
		message "No platform specified in global component."
		return
	endif

! Build the spool command and execute it. This needs to be in the
! background, else the graphics process can't respond to the query
! generated by the spoolgif.pl script.

	local cmd concat3('"./realtime/spoolgif.pl ',c$msgname," ")
	local cmd concat3(cmd, window_name, " ")
	local amp ' &"'
	local cmd concat3(cmd, platform, amp)

	shell #cmd

endprocedure

